# [delayed_gcode LED]
# initial_duration: 1.
# gcode:
#   SET_LED LED="Led_Bar" RED=1 GREEN=1 BLUE=1 SYNC=0 TRANSMIT=1

# [led_effect Main_idle] 
# leds:
#     neopixel:Led_Bar
# Layers:
#     gradient 1 1 top (1,0,0),(0,1,0),(0,0,1)
# autostart: false
# frame_rate: 24

[delayed_gcode led_progress_loop]
initial_duration: 5
gcode:
  {% if printer.print_stats.state == "printing" %}
    LED_PROGRESS
    UPDATE_DELAYED_GCODE ID=led_progress_loop DURATION=5
  {% endif %}

[gcode_macro LED_PROGRESS]
description: Show print progress on front half of LED_Bar (LEDs 1â€“16)
gcode:
  {% set total_leds = printer.configfile.settings.neopixel.Led_Bar.chain_count|int %}
  {% set led_count = total_leds // 2 %}  # First half
  {% set progress = printer.print_stats.progress|float %}
  {% set lit_leds = (led_count * progress)|int %}

  {% for i in range(led_count) %}
    {% set led_index = i + 1 %}
    {% if i < lit_leds %}
      # Lit LEDs - green
      SET_LED LED=Led_Bar INDEX={led_index} RED=0.0 GREEN=1.0 BLUE=0.0
    {% else %}
      # Remaining LEDs - dim/off
      SET_LED LED=Led_Bar INDEX={led_index} RED=0.02 GREEN=0.02 BLUE=0.02
    {% endif %}
  {% endfor %}